/*
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */


#ifndef CTEXTUTILS_SIMPLIFY
#define CTEXTUTILS_SIMPLIFY

#include "unicode_util.h"

unsigned long int UNICODE_SIMPLIFY_MAPPING[] = {

        215, 'x',
        247, '/',
        192, 'A',
        193, 'A',
        194, 'A',
        195, 'A',
        196, 'A',
        197, 'A',
        198, 'A',
        199, 'C',
        200, 'E',
        201, 'E',
        202, 'E',
        203, 'E',
        204, 'I',
        205, 'I',
        206, 'I',
        207, 'I',
        208, 'D',
        209, 'N',
        210, 'O',
        211, 'O',
        212, 'O',
        213, 'O',
        214, 'O',
        216, 'O',
        217, 'U',
        218, 'U',
        219, 'U',
        220, 'U',
        221, 'Y',
        222, 'T',
        223, 'S',
        224, 'a',
        225, 'a',
        226, 'a',
        227, 'a',
        228, 'a',
        229, 'a',
        230, 'a',
        231, 'c',
        232, 'e',
        233, 'e',
        234, 'e',
        235, 'e',
        236, 'i',
        237, 'i',
        238, 'i',
        239, 'i',
        240, 'e',
        241, 'n',
        242, 'o',
        243, 'o',
        244, 'o',
        245, 'o',
        246, 'o',
        248, 'o',
        249, 'u',
        250, 'u',
        251, 'u',
        252, 'u',
        253, 'y',
        254, 't',
        255, 'y',
        160, ' ',
        161, 'i',
        162, 'c',
        163, 'l',
        164, 'c',
        165, 'Y',
        166, 'I',
        167, 's',
        168, ':',
        169, 'c',
        170, 'a',
        171, '<',
        172, '!',
        173, '-',
        174, 'r',
        175, '-',
        176, '.',
        177, '+',
        178, '2',
        179, '3',
        180, '\'',
        181, 'u',
        182, ' ',
        183, '.',
        184, '.',
        185, '1',
        186, '0',
        187, '>',
        188, '4',
        189, '2',
        190, '3',
        191, '?',

        256, 'A',
        257, 'a',
        258, 'A',
        259, 'a',
        260, 'A',
        261, 'a',
        262, 'C',
        263, 'c',
        264, 'C',
        265, 'c',
        266, 'C',
        267, 'c',
        268, 'C',
        269, 'c',
        270, 'D',
        271, 'd',
        272, 'D',
        273, 'd',
        274, 'E',
        275, 'e',
        276, 'E',
        277, 'e',
        278, 'E',
        279, 'e',
        280, 'E',
        281, 'e',
        282, 'E',
        283, 'e',
        284, 'G',
        285, 'g',
        286, 'G',
        287, 'g',
        288, 'G',
        289, 'g',
        290, 'G',
        291, 'g',
        292, 'H',
        293, 'h',
        294, 'H',
        295, 'h',
        296, 'I',
        297, 'i',
        298, 'I',
        299, 'i',
        300, 'I',
        301, 'i',
        302, 'I',
        303, 'i',
        304, 'I',
        305, 'i',
        306, 'J',
        307, 'j',
        308, 'J',
        309, 'j',
        310, 'K',
        311, 'k',
        312, 'k',
        313, 'L',
        314, 'l',
        315, 'L',
        316, 'l',
        317, 'L',
        318, 'l',
        319, 'L',
        320, 'l',
        321, 'L',
        322, 'l',
        323, 'N',
        324, 'n',
        325, 'N',
        326, 'n',
        327, 'N',
        328, 'n',
        329, 'n',
        330, 'N',
        331, 'n',
        332, 'O',
        333, 'o',
        334, 'O',
        335, 'o',
        336, 'O',
        337, 'o',
        338, 'O',
        339, 'o',
        340, 'R',
        341, 'r',
        342, 'R',
        343, 'r',
        344, 'R',
        345, 'r',
        346, 'S',
        347, 's',
        348, 'S',
        349, 'S',
        350, 'S',
        351, 's',
        352, 'S',
        353, 's',
        354, 'T',
        355, 't',
        356, 'T',
        357, 't',
        358, 't',
        359, 't',
        360, 'U',
        361, 'u',
        362, 'U',
        363, 'u',
        364, 'U',
        365, 'u',
        366, 'U',
        367, 'u',
        368, 'U',
        369, 'u',
        370, 'U',
        371, 'u',
        372, 'W',
        373, 'w',
        374, 'Y',
        375, 'y',
        376, 'Y',
        377, 'Z',
        378, 'z',
        379, 'Z',
        380, 'z',
        381, 'Z',
        382, 'z',
        383, 's',

        384, 'b',
        385, 'B',
        386, 'b',
        387, 'b',
        388, 'b',
        389, 'b',
        390, 'C',
        391, 'C',
        392, 'c',
        393, 'D',
        394, 'D',
        395, 'd',
        396, 'd',
        397, 'd',
        398, 'E',
        399, 'e',
        400, 'E',
        401, 'F',
        402, 'f',
        403, 'G',
        404, 'G',
        405, 'h',
        406, 'l',
        407, 'I',
        408, 'K',
        409, 'k',
        410, 'l',
        411, 'l',
        412, 'W',
        413, 'N',
        414, 'n',
        415, 'O',
        416, 'O',
        417, 'o',
        418, 'p',
        419, 'p',
        420, 'p',
        421, 'p',
        422, 'R',
        423, 'S',
        424, 's',
        425, 'E',
        426, 'l',
        427, 't',
        428, 'T',
        429, 't',
        430, 'T',
        431, 'U',
        432, 'u',
        433, 'v',
        434, 'v',
        435, 'Y',
        436, 'y',
        437, 'Z',
        438, 'z',
        439, 'e',
        440, 'e',
        441, 'E',
        442, 'E',
        443, 'e',
        444, '5',
        445, '5',
        446, '!',
        447, 'W',
        448, '?',
        449, '?',
        450, '?',
        451, '!',
        452, 'D',
        453, 'D',
        454, 'd',
        455, 'L',
        456, 'L',
        457, 'l',
        458, 'N',
        459, 'N',
        460, 'n',
        461, 'A',
        462, 'a',
        463, 'I',
        464, 'i',
        465, 'O',
        466, 'o',
        467, 'U',
        468, 'u',
        469, 'U',
        470, 'u',
        471, 'U',
        472, 'u',
        473, 'U',
        474, 'u',
        475, 'U',
        476, 'u',
        477, 'e',
        478, 'A',
        479, 'a',
        480, 'A',
        481, 'a',
        482, 'A',
        483, 'a',
        484, 'G',
        485, 'g',
        486, 'G',
        487, 'g',
        488, 'K',
        489, 'k',
        490, 'Q',
        491, 'q',
        492, 'Q',
        493, 'q',
        494, '3',
        495, '3',
        496, 'J',
        497, 'D',
        498, 'D',
        499, 'd',
        500, 'G',
        501, 'g',
        502, 'H',
        503, 'W',
        504, 'N',
        505, 'n',
        506, 'A',
        507, 'a',
        508, 'A',
        509, 'A',
        510, 'O',
        511, 'o',
        512, 'A',
        513, 'a',
        514, 'A',
        515, 'A',
        516, 'E',
        517, 'e',
        518, 'E',
        519, 'e',
        520, 'I',
        521, 'i',
        522, 'I',
        523, 'i',
        524, 'O',
        525, 'o',
        526, 'O',
        527, 'o',
        528, 'R',
        529, 'r',
        530, 'R',
        531, 'r',
        532, 'U',
        533, 'u',
        534, 'U',
        535, 'u',
        536, 'S',
        537, 's',
        538, 'T',
        539, 't',
        540, '3',
        541, '3',
        542, 'H',
        543, 'h',
        544, 'n',
        545, 'd',
        546, '8',
        547, '8',
        548, 'Z',
        549, 'z',
        550, 'A',
        551, 'a',
        552, 'E',
        553, 'e',
        554, 'O',
        555, 'o',
        556, 'O',
        557, 'o',
        558, 'O',
        559, 'o',
        560, 'O',
        561, 'o',
        562, 'Y',
        563, 'y',
        564, 'l',
        565, 'n',
        566, 't',
        567, 'J',
        568, 'b',
        569, 'b',
        570, 'A',
        571, 'C',
        572, 'c',
        573, 'L',
        574, 'T',
        575, 's',
        576, 'z',
        577, '?',
        578, '?',
        579, 'B',
        580, 'U',
        581, 'A',
        582, 'E',
        583, 'e',
        584, 'J',
        585, 'j',
        586, 'q',
        587, 'q',
        588, 'R',
        589, 'r',
        590, 'Y',
        591, 'y',

        //List termination
        0, 0
};

/**
 *
 */
void __unicode_simplify(unsigned long int codepoint, char *out) {

    if (codepoint < 127) {
        *out = (int) codepoint;
    } else {
        *out = '?';
        for (int i = 0; UNICODE_SIMPLIFY_MAPPING[i] != 0; i += 2) {
            if (codepoint == UNICODE_SIMPLIFY_MAPPING[i]) {
                *out = (int) UNICODE_SIMPLIFY_MAPPING[i + 1];
                break;
            }
        }
    }

}

/**
 * Find unicode sequences and replace each by a single char.
 * See UNICODE_SIMPLIFY_MAPPING
 */
char *unicode_simplify(const char *s, size_t offset, size_t len) {
    return unicode_iterate(s, offset, len, &__unicode_simplify);
}

#endif //CTEXTUTILS_SIMPLIFY